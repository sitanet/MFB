{% extends 'base.html' %}
{% load static %}

{% block content %}
{% include 'includes/alerts.html' %}
{% include 'reports/includes/report_styles.html' %}

<div class="report-page">
    <!-- Page Header -->
    <div class="report-page-header no-print">
        <h2 class="report-page-title">
            <i class="fas fa-file-invoice-dollar"></i>
            Statement of Account
        </h2>
        <div class="report-header-actions">
            <a href="{% url 'front_office_report' %}" class="report-btn report-btn-back">
                <i class="fas fa-arrow-left"></i> Back
            </a>
        </div>
    </div>

    <!-- Filter Form -->
    <div class="report-filter-container">
        <div class="report-filter-header">
            <i class="fas fa-filter"></i>
            Generate Statement
        </div>
        <div class="report-filter-body">
            {{ form.errors }}
            <form id="generateForm" method="post" action="{% url 'generate_statement' %}">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-3">
                        <div class="report-form-group">
                            <label class="report-form-label">
                                <i class="fas fa-calendar"></i> Start Date
                            </label>
                            <input type="date" class="report-form-control" name="start_date" 
                                   id="start_date" value="{{ company_date }}" required>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="report-form-group">
                            <label class="report-form-label">
                                <i class="fas fa-calendar-check"></i> End Date
                            </label>
                            <input type="date" class="report-form-control" name="end_date" 
                                   id="end_date" value="{{ company_date }}" required>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="report-form-group">
                            <label class="report-form-label">
                                <i class="fas fa-book"></i> GL Number
                            </label>
                            <input type="text" class="report-form-control" name="gl_no" 
                                   placeholder="Enter GL No." required>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="report-form-group">
                            <label class="report-form-label">
                                <i class="fas fa-id-card"></i> Account Number
                            </label>
                            <input type="text" class="report-form-control" name="ac_no" 
                                   placeholder="Enter Account No." required>
                        </div>
                    </div>
                </div>
                <input type="hidden" id="pageInput" name="page" value="">
                <button type="submit" class="report-btn report-btn-generate">
                    <i class="fas fa-cogs"></i> Generate Statement
                </button>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var startDateInput = document.getElementById('start_date');
    var endDateInput = document.getElementById('end_date');
    var companyDate = '{{ company_date }}';

    function validateDate(input) {
        var selectedDate = new Date(input.value);
        var companyDateObj = new Date(companyDate);

        if (selectedDate > companyDateObj) {
            alert('Please select a date not greater than the session date.');
            input.value = companyDate; 
        }
    }

    startDateInput.addEventListener('change', function() {
        validateDate(startDateInput);
    });

    endDateInput.addEventListener('change', function() {
        validateDate(endDateInput);
    });
});
</script>

{% endblock %}
