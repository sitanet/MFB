{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="midde_cont">
    <div class="container-fluid">
        <div class="row column_title">
            <div class="col-md-12">
                <div class="page_title">
                    <h2><i class="fa fa-shield"></i> Role Permissions Overview</h2>
                </div>
            </div>
        </div>

        {% include 'includes/alerts.html' %}

        <div class="row">
            <div class="col-md-12">
                <div class="white_shd full margin_bottom_30">
                    <div class="full graph_head" style="background: linear-gradient(135deg, #FF4500 0%, #FF6B35 100%);">
                        <div class="heading1 margin_0">
                            <h2 style="color: #fff;"><i class="fa fa-list"></i> All Role Permissions</h2>
                        </div>
                    </div>
                    <div class="full inner_bt">
                        <div class="table_section padding_infor_info">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="thead-dark">
                                        <tr>
                                            <th style="width: 5%;">#</th>
                                            <th style="width: 30%;">Role Name</th>
                                            <th style="width: 25%;">Permissions Assigned</th>
                                            <th style="width: 20%;">Progress</th>
                                            <th style="width: 20%;">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for role in role_permissions_list %}
                                            <tr>
                                                <td>{{ forloop.counter }}</td>
                                                <td>
                                                    <i class="fa fa-user-circle" style="color: #FF4500;"></i>
                                                    <strong>{{ role.role_name }}</strong>
                                                    {% if role.role_id == 1 %}
                                                        <span class="badge badge-success ml-2">Admin - Full Access</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if role.role_id == 1 %}
                                                        <span class="badge badge-success" style="font-size: 14px;">
                                                            {{ role.total_features }}/{{ role.total_features }}
                                                        </span>
                                                        <span class="text-success"> (All Features)</span>
                                                    {% else %}
                                                        <span class="badge {% if role.permission_count > 0 %}badge-primary{% else %}badge-secondary{% endif %}" 
                                                              style="font-size: 14px; {% if role.permission_count > 0 %}background-color: #FF4500;{% endif %}">
                                                            {{ role.permission_count }}/{{ role.total_features }}
                                                        </span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if role.role_id == 1 %}
                                                        <div class="progress" style="height: 20px;">
                                                            <div class="progress-bar bg-success" role="progressbar" style="width: 100%;">
                                                                100%
                                                            </div>
                                                        </div>
                                                    {% else %}
                                                        {% widthratio role.permission_count role.total_features 100 as percent %}
                                                        <div class="progress" style="height: 20px;">
                                                            <div class="progress-bar" role="progressbar" 
                                                                 style="width: {{ percent }}%; background-color: #FF4500;">
                                                                {{ percent }}%
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if role.role_id != 1 %}
                                                        <a href="{% url 'manage_role_permissions' %}?role={{ role.role_id }}" 
                                                           class="btn btn-sm" style="background-color: #FF4500; color: #fff;">
                                                            <i class="fa fa-edit"></i> Configure
                                                        </a>
                                                    {% else %}
                                                        <span class="text-muted">
                                                            <i class="fa fa-lock"></i> Cannot modify
                                                        </span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="row">
            <div class="col-md-4">
                <div class="white_shd full margin_bottom_30">
                    <div class="full inner_bt" style="padding: 20px; text-align: center;">
                        <i class="fa fa-users fa-3x" style="color: #FF4500;"></i>
                        <h3 class="mt-3">{{ role_permissions_list|length }}</h3>
                        <p class="text-muted">Total Roles</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="white_shd full margin_bottom_30">
                    <div class="full inner_bt" style="padding: 20px; text-align: center;">
                        <i class="fa fa-check-square fa-3x" style="color: #28a745;"></i>
                        <h3 class="mt-3">{{ role_permissions_list.0.total_features }}</h3>
                        <p class="text-muted">Total Features</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="white_shd full margin_bottom_30">
                    <div class="full inner_bt" style="padding: 20px; text-align: center;">
                        <i class="fa fa-shield fa-3x" style="color: #007bff;"></i>
                        <h3 class="mt-3">Secure</h3>
                        <p class="text-muted">Role-Based Access</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Box -->
        <div class="row">
            <div class="col-md-12">
                <div class="alert alert-info">
                    <h5><i class="fa fa-info-circle"></i> About Role Permissions</h5>
                    <ul class="mb-0">
                        <li><strong>System Administrator</strong> has full access to all features and cannot be restricted.</li>
                        <li>Click <strong>Configure</strong> to set specific permissions for each role.</li>
                        <li>Users with unconfigured permissions will be denied access to restricted features.</li>
                        <li>Changes take effect immediately after saving.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
