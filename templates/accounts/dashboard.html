{% extends "base.html" %}
{% block content %}
<!-- Load Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto :wght@400;500;700&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Roboto', sans-serif;
    background-color: #f8f9fa;
  }

  .card {
    border-radius: 1rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .card:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
  }

  .hover-scale {
    transition: transform 0.2s ease-in-out;
  }

  .hover-scale:hover {
    transform: scale(1.02);
  }

  .badge-success {
    background-color: #1cc88a;
  }

  .badge-primary {
    background-color: #1a6e1a;
  }

  .badge-warning {
    background-color: #f6c23e;
  }

  .text-primary {
    color: #1a6e1a !important;
  }

  .btn-primary {
    background-color: #1a6e1a;
    border-color: #1a6e1a;
  }

  .btn-primary:hover {
    background-color: #0d4d0d;
    border-color: #0d4d0d;
  }

  .chart-area canvas {
    max-height: 300px;
  }

  ::-webkit-scrollbar {
    width: 6px;
  }

  ::-webkit-scrollbar-thumb {
    background: #1a6e1a;
    border-radius: 10px;
  }
</style>

<div class="container-fluid py-4">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-md-12">
      <div class="page-header p-4 rounded-3 text-white"
           style="background: linear-gradient(to right, rgb(241, 107, 58), #0d4d0d);">
        <h2 class="font-weight-bold"><i class="fas fa-university mr-2"></i>FinanceFlex Banking Dashboard</h2>
        <p class="mb-0">Comprehensive overview of your financial institution's performance</p>
      </div>
    </div>
  </div>

  <!-- Summary Cards -->
  {% include "summary_cards.html" %}

  <!-- Charts -->
  <div class="row">
    <div class="col-xl-8 col-lg-7 mb-4">
      <div class="card shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center bg-white border-0">
          <h6 class="m-0 font-weight-bold text-primary">
            <i class="fas fa-chart-bar mr-1"></i> Deposits vs Loans Overview
          </h6>
          <div class="dropdown no-arrow">
            <button class="btn btn-link btn-sm dropdown-toggle" type="button" id="dropdownMenuButton"
                    data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fas fa-ellipsis-v fa-sm text-gray-400"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
              <li><a class="dropdown-item" href="#">Last 30 Days</a></li>
              <li><a class="dropdown-item" href="#">Last Quarter</a></li>
              <li><a class="dropdown-item" href="#">Last Year</a></li>
            </ul>
          </div>
        </div>
        <div class="card-body pt-0">
          <canvas id="depositsLoansChart"></canvas>
          <div class="mt-3 small text-muted d-flex justify-content-between">
            <span><i class="fas fa-circle text-primary mr-1"></i> Deposits</span>
            <span><i class="fas fa-circle text-success mr-1"></i> Loans</span>
            <span><i class="fas fa-sync-alt mr-1"></i> Updated 1 hour ago</span>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-4 col-lg-5 mb-4">
      <div class="card shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center bg-white border-0">
          <h6 class="m-0 font-weight-bold text-primary">
            <i class="fas fa-users mr-1"></i> Customer Segmentation
          </h6>
          <i class="fas fa-user-tag text-primary"></i>
        </div>
        <div class="card-body">
          <canvas id="customerSegmentationChart" height="120"></canvas>
          <div class="mt-4 text-center small">
            <span class="mr-3"><i class="fas fa-circle text-primary"></i> Retail (62%)</span>
            <span class="mr-3"><i class="fas fa-circle text-success"></i> Business (28%)</span>
            <span><i class="fas fa-circle text-info"></i> Premium (10%)</span>
          </div>
          <div class="mt-3 text-center">
            <button class="btn btn-outline-primary btn-sm">
              <i class="fas fa-download mr-1"></i> Export Data
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Additional Metrics -->
  {% include "loan_transactions.html" %}

  <!-- Branch Performance Table -->
  <div class="row">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center bg-white border-0">
          <h6 class="m-0 font-weight-bold text-primary">
            <i class="fas fa-map-marker-alt mr-1"></i> Branch Performance
          </h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th>Branch</th>
                  <th>Location</th>
                  <th>Customers</th>
                  <th>Deposits</th>
                  <th>Loans</th>
                  <th>Profit</th>
                  <th>NPL Ratio</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>Lagos Main</strong></td>
                  <td>Victoria Island</td>
                  <td>5,420</td>
                  <td>₦1.25T</td>
                  <td>₦980B</td>
                  <td class="text-success">₦42.5B</td>
                  <td>4.2%</td>
                  <td><span class="badge badge-success">Excellent</span></td>
                </tr>
                <tr>
                  <td><strong>Abuja Central</strong></td>
                  <td>Central Business District</td>
                  <td>4,850</td>
                  <td>₦890B</td>
                  <td>₦720B</td>
                  <td class="text-success">₦31.2B</td>
                  <td>5.1%</td>
                  <td><span class="badge badge-success">Excellent</span></td>
                </tr>
                <tr>
                  <td><strong>Port Harcourt</strong></td>
                  <td>GRA Phase 2</td>
                  <td>3,920</td>
                  <td>₦750B</td>
                  <td>₦610B</td>
                  <td class="text-success">₦28.7B</td>
                  <td>5.8%</td>
                  <td><span class="badge badge-primary">Good</span></td>
                </tr>
                <tr>
                  <td><strong>Kano</strong></td>
                  <td>Zaria Road</td>
                  <td>3,450</td>
                  <td>₦680B</td>
                  <td>₦550B</td>
                  <td class="text-success">₦25.1B</td>
                  <td>6.5%</td>
                  <td><span class="badge badge-primary">Good</span></td>
                </tr>
                <tr>
                  <td><strong>Ibadan</strong></td>
                  <td>Bodija</td>
                  <td>2,870</td>
                  <td>₦520B</td>
                  <td>₦420B</td>
                  <td class="text-warning">₦18.3B</td>
                  <td>7.2%</td>
                  <td><span class="badge badge-warning">Fair</span></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="mt-3 text-end">
            <button class="btn btn-primary">
              <i class="fas fa-download me-1"></i> Export Report
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="/vendor/chart.js/Chart.min.js"></script>
<script>
  // Chart configuration (same as before)
  var ctx = document.getElementById("depositsLoansChart");
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
      datasets: [{
        label: "Deposits",
        lineTension: 0.3,
        backgroundColor: "rgba(78, 115, 223, 0.05)",
        borderColor: "rgba(78, 115, 223, 1)",
        pointRadius: 3,
        pointBackgroundColor: "rgba(78, 115, 223, 1)",
        pointBorderColor: "rgba(78, 115, 223, 1)",
        pointHoverRadius: 3,
        pointHoverBackgroundColor: "rgba(78, 115, 223, 1)",
        pointHitRadius: 10,
        pointBorderWidth: 2,
        data: [3.8, 3.9, 4.0, 4.1, 4.2, 4.3, 4.4, 4.5, 4.55, 4.6, 4.7, 4.78],
      }, {
        label: "Loans",
        lineTension: 0.3,
        backgroundColor: "rgba(28, 200, 138, 0.05)",
        borderColor: "rgba(28, 200, 138, 1)",
        pointRadius: 3,
        pointBackgroundColor: "rgba(28, 200, 138, 1)",
        pointBorderColor: "rgba(28, 200, 138, 1)",
        pointHoverRadius: 3,
        pointHoverBackgroundColor: "rgba(28, 200, 138, 1)",
        pointHitRadius: 10,
        pointBorderWidth: 2,
        data: [2.9, 3.0, 3.1, 3.2, 3.3, 3.4, 3.45, 3.5, 3.55, 3.6, 3.65, 3.7],
      }],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        yAxes: [{
          ticks: {
            callback: function(value) {
              return '₦' + value + 'T';
            }
          }
        }]
      },
      tooltips: {
        callbacks: {
          label: function(tooltipItem, data) {
            return data.datasets[tooltipItem.datasetIndex].label + ': ₦' + tooltipItem.yLabel + 'T';
          }
        }
      }
    }
  });

  var ctx2 = document.getElementById("customerSegmentationChart");
  new Chart(ctx2, {
    type: 'doughnut',
    data: {
      labels: ["Retail", "Business", "Premium"],
      datasets: [{
        data: [62, 28, 10],
        backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc'],
        hoverBackgroundColor: ['#2e59d9', '#17a673', '#2c9faf'],
        hoverBorderColor: "rgba(234, 236, 244, 1)"
      }]
    },
    options: {
      cutoutPercentage: 75
    }
  });
</script>
{% endblock %}