{% extends 'base.html' %}
{% load humanize %}

{% block content %}
<div class="midde_cont">
    <div class="container-fluid">
        <div class="row column_title">
            <div class="col-md-12">
                <div class="page_title">
                    <h2>Merchant Service Configuration</h2>
                </div>
            </div>
        </div>
        
        <div class="row">
            <!-- Add/Edit Form -->
            <div class="col-md-4">
                <div class="white_shd full margin_bottom_30">
                    <div class="full graph_head">
                        <div class="heading1 margin_0">
                            <h2>Add Service Config</h2>
                        </div>
                    </div>
                    <div class="full price_table padding_inset">
                        <form method="post">
                            {% csrf_token %}
                            
                            <div class="mb-3">
                                <label class="form-label">Service Type</label>
                                {{ form.service_type }}
                                {% if form.service_type.errors %}
                                <div class="text-danger">{{ form.service_type.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Enabled</label>
                                <div class="form-check">
                                    {{ form.is_enabled }}
                                    <label class="form-check-label">Service is active</label>
                                </div>
                            </div>
                            
                            <hr>
                            <h6 class="text-muted">Charge Settings</h6>
                            
                            <div class="mb-3">
                                <label class="form-label">Charge Type</label>
                                {{ form.charge_type }}
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Charge Value</label>
                                {{ form.charge_value }}
                                <small class="text-muted">Amount or percentage depending on type</small>
                            </div>
                            
                            <div class="row">
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label class="form-label">Min Charge</label>
                                        {{ form.min_charge }}
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label class="form-label">Max Charge</label>
                                        {{ form.max_charge }}
                                    </div>
                                </div>
                            </div>
                            
                            <hr>
                            <h6 class="text-muted">Commission Settings</h6>
                            
                            <div class="mb-3">
                                <label class="form-label">Commission Type</label>
                                {{ form.commission_type }}
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Commission Value</label>
                                {{ form.commission_value }}
                            </div>
                            
                            <hr>
                            <h6 class="text-muted">Transaction Limits</h6>
                            
                            <div class="row">
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label class="form-label">Min Amount</label>
                                        {{ form.min_amount }}
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="mb-3">
                                        <label class="form-label">Max Amount</label>
                                        {{ form.max_amount }}
                                    </div>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-save"></i> Save Configuration
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Existing Configs -->
            <div class="col-md-8">
                <div class="white_shd full margin_bottom_30">
                    <div class="full graph_head">
                        <div class="heading1 margin_0">
                            <h2>Service Configurations</h2>
                        </div>
                    </div>
                    <div class="table_section padding_inset">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Service</th>
                                        <th>Status</th>
                                        <th>Charge</th>
                                        <th>Commission</th>
                                        <th>Limits</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for config in configs %}
                                    <tr>
                                        <td>
                                            <strong>{{ config.get_service_type_display }}</strong>
                                        </td>
                                        <td>
                                            {% if config.is_enabled %}
                                            <span class="badge bg-success">Enabled</span>
                                            {% else %}
                                            <span class="badge bg-secondary">Disabled</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if config.charge_type == 'flat' %}
                                            ₦{{ config.charge_value|floatformat:2|intcomma }}
                                            {% else %}
                                            {{ config.charge_value }}%
                                            {% endif %}
                                            {% if config.min_charge or config.max_charge %}
                                            <br><small class="text-muted">
                                                Min: ₦{{ config.min_charge|floatformat:0|intcomma }} | 
                                                Max: ₦{{ config.max_charge|floatformat:0|intcomma }}
                                            </small>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if config.commission_type == 'flat' %}
                                            ₦{{ config.commission_value|floatformat:2|intcomma }}
                                            {% else %}
                                            {{ config.commission_value }}%
                                            {% endif %}
                                        </td>
                                        <td>
                                            <small>
                                                ₦{{ config.min_amount|floatformat:0|intcomma }} - 
                                                ₦{{ config.max_amount|floatformat:0|intcomma }}
                                            </small>
                                        </td>
                                        <td>
                                            <div class="btn-group">
                                                <button type="button" class="btn btn-sm btn-outline-primary" 
                                                        onclick="editConfig('{{ config.id }}')" title="Edit">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button type="button" class="btn btn-sm btn-outline-danger" 
                                                        onclick="deleteConfig('{{ config.id }}')" title="Delete">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="6" class="text-center py-4">
                                            <i class="fas fa-cogs fa-3x text-muted mb-3"></i>
                                            <p class="text-muted">No service configurations found</p>
                                            <p class="text-muted small">Use the form to add your first service configuration</p>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .form-control, .form-select {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    .form-check-input {
        width: 20px;
        height: 20px;
    }
</style>

<script>
function editConfig(id) {
    alert('Edit functionality - Config ID: ' + id);
}

function deleteConfig(id) {
    if (confirm('Are you sure you want to delete this configuration?')) {
        alert('Delete functionality - Config ID: ' + id);
    }
}
</script>
{% endblock %}
